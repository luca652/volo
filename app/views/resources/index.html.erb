<%= stylesheet_link_tag 'resources', media: 'all', 'data-turbolinks-track': 'reload' %>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="container">
  <div class="filter-container">
    <!-- Filter controls... -->
  </div>

  <div class="card-container">
    <% @resources.each do |resource| %>
      <div class="card" data-category="<%= resource.category %>" data-resource-id="<%= resource.id %>"> <!-- Added data-resource-id attribute -->
        <div class="card-body">
          <h5 class="card-title"><%= resource.title %></h5>
          <p class="card-text card-text-category"><%= resource.category %></p>
          <p class="card-text"><%= resource.comment %></p>
          <p class="card-text"><%= resource.picture_url %></p>
          <p>Pins: <span class="pin-count"><%= resource.pin_count %></span></p> <!-- Updated line -->
          <a href="#" class="pin-button" data-resource-id="<%= resource.id %>">
            <i class="fas fa-thumbtack"></i>
          </a>
        </div>
      </div>
    <% end %>
  </div>

  <div class="pins-container">
    <!-- Placeholder for pin cards -->
  </div>
</div>

<script>
  $(document).ready(function() {
    // ...

    // Pin button click event handler
    $(document).on('click', '.pin-button', function(e) {
      e.preventDefault();
      var pinButton = $(this);
      var resourceId = pinButton.data('resource-id');

      $.ajaxSetup({
        headers: {
          'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
        }
      });

      $.ajax({
        type: 'POST',
        url: '/resources/' + resourceId + '/pins',
        dataType: 'json',
        success: function(response) {
          if (response.error) {
            alert(response.error);
          } else {
            console.log(response);

            // Update the pin count for the corresponding resource card
            var card = pinButton.closest('.card');
            var pinCount = card.find('.pin-count');

            // Increment the pin count
            var currentCount = parseInt(pinCount.text());
            pinCount.text(currentCount + 1);

            // Disable the pin button
            pinButton.attr('disabled', true);
          }
        },
        error: function(xhr, status, error) {
          console.log(xhr.responseText);
        }
      });
    });
  });
</script>
